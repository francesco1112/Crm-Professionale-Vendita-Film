<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>CRM Professionale Vendita Film</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box;}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:#fff;
}
.wrapper{
    max-width:1200px;
    margin:40px auto;
    background:#fff;
    color:#000;
    border-radius:20px;
    padding:30px;
    box-shadow:0 20px 50px rgba(0,0,0,0.4);
}
h2{margin-bottom:25px;}

.form-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
    margin-bottom:25px;
}
input,select{
    width:100%;
    padding:14px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:14px;
    transition:0.3s;
}
input:focus,select:focus{
    border-color:#2c5364;
    box-shadow:0 0 8px rgba(44,83,100,0.4);
    outline:none;
}
button{
    padding:10px 18px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    transition:0.2s;
}
.add-btn{background:#2c5364;color:#fff;}
.edit-btn{background:#f39c12;color:#fff;}
.delete-btn{background:#e74c3c;color:#fff;}
.pdf-btn{background:#000;color:#fff;margin-top:20px;}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:25px;
}
th{
    background:#2c5364;
    color:#fff;
    padding:12px;
}
td{
    padding:10px;
    border-bottom:1px solid #ddd;
    text-align:center;
}
tr:hover{background:#f5f5f5;}

.total-box{
    margin-top:20px;
    font-size:20px;
    font-weight:bold;
}
</style>
</head>
<body>

<div class="wrapper">
<h2>CRM Professionale Vendita Film</h2>

<div class="form-grid">
<input type="text" id="descrizione" placeholder="Descrizione prodotto">
<select id="supporto">
<option value="DVD">DVD</option>
<option value="DVX">DVX</option>
<option value="MP4">MP4</option>
</select>
<input type="number" id="quantita" placeholder="Quantit√†" min="1">
<input type="number" id="prezzo" placeholder="Prezzo Unitario" step="0.01">
</div>

<button class="add-btn" onclick="aggiungiProdotto()">‚ûï Aggiungi Prodotto</button>

<table id="tabella">
<thead>
<tr>
<th>Descrizione</th>
<th>Supporto</th>
<th>Quantit√†</th>
<th>Prezzo</th>
<th>Totale</th>
<th>Modifica</th>
<th>Elimina</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="total-box">
Totale Finale: ‚Ç¨ <span id="totaleFinale">0.00</span>
</div>

<button class="pdf-btn" onclick="esportaPDF()">üìÑ Esporta PDF Orizzontale</button>

</div>

<script>

let prodotti = JSON.parse(localStorage.getItem("prodotti")) || [];
let totaleGenerale = 0;

function salvaDati(){
    localStorage.setItem("prodotti", JSON.stringify(prodotti));
}

function caricaTabella(){
    const tbody = document.querySelector("#tabella tbody");
    tbody.innerHTML="";
    totaleGenerale=0;

    prodotti.forEach((p,index)=>{
        totaleGenerale += p.totale;

        let riga = tbody.insertRow();
        riga.innerHTML=`
        <td>${p.descrizione}</td>
        <td>${p.supporto}</td>
        <td>${p.quantita}</td>
        <td>‚Ç¨ ${p.prezzo.toFixed(2)}</td>
        <td>‚Ç¨ ${p.totale.toFixed(2)}</td>
        <td><button class="edit-btn" onclick="modificaProdotto(${index})">‚úè</button></td>
        <td><button class="delete-btn" onclick="eliminaProdotto(${index})">X</button></td>
        `;
    });

    document.getElementById("totaleFinale").innerText = totaleGenerale.toFixed(2);
}

function aggiungiProdotto(){
    let descrizione=document.getElementById("descrizione").value.trim();
    let supporto=document.getElementById("supporto").value;
    let quantita=parseFloat(document.getElementById("quantita").value);
    let prezzo=parseFloat(document.getElementById("prezzo").value);

    if(!descrizione || !quantita || !prezzo){
        alert("Compila tutti i campi");
        return;
    }

    let totale=quantita*prezzo;

    prodotti.push({
        descrizione,
        supporto,
        quantita,
        prezzo,
        totale
    });

    salvaDati();
    caricaTabella();

    document.getElementById("descrizione").value="";
    document.getElementById("quantita").value="";
    document.getElementById("prezzo").value="";
}

function eliminaProdotto(index){
    prodotti.splice(index,1);
    salvaDati();
    caricaTabella();
}

function modificaProdotto(index){
    let p=prodotti[index];

    let nuovaDescrizione=prompt("Modifica Descrizione:",p.descrizione);
    if(nuovaDescrizione===null) return;

    let nuovoSupporto=prompt("Modifica Supporto (DVD,DVX,MP4):",p.supporto);
    if(nuovoSupporto===null) return;

    let nuovaQuantita=parseFloat(prompt("Modifica Quantit√†:",p.quantita));
    if(isNaN(nuovaQuantita)) return;

    let nuovoPrezzo=parseFloat(prompt("Modifica Prezzo:",p.prezzo));
    if(isNaN(nuovoPrezzo)) return;

    prodotti[index]={
        descrizione:nuovaDescrizione,
        supporto:nuovoSupporto,
        quantita:nuovaQuantita,
        prezzo:nuovoPrezzo,
        totale:nuovaQuantita*nuovoPrezzo
    };

    salvaDati();
    caricaTabella();
}

async function esportaPDF(){

    const { jsPDF } = window.jspdf;

    const doc = new jsPDF({
        orientation:"landscape",
        unit:"mm",
        format:"a4"
    });

    let y=20;

    doc.setFontSize(18);
    doc.text("REPORT VENDITA FILM",148,y,{align:"center"});
    y+=15;

    doc.setFontSize(12);

    doc.text("Descrizione",10,y);
    doc.text("Supporto",180,y);
    doc.text("Qta",210,y);
    doc.text("Prezzo",230,y);
    doc.text("Totale",260,y);

    y+=8;
    doc.line(10,y,287,y);
    y+=8;

    prodotti.forEach(p=>{

        if(y>190){
            doc.addPage();
            y=20;
        }

        let descrizioneSplit=doc.splitTextToSize(p.descrizione,160);

        doc.text(descrizioneSplit,10,y);
        doc.text(p.supporto,180,y);
        doc.text(p.quantita.toString(),210,y);
        doc.text("‚Ç¨ "+p.prezzo.toFixed(2),230,y);
        doc.text("‚Ç¨ "+p.totale.toFixed(2),260,y);

        y+=descrizioneSplit.length*6;
        y+=5;
    });

    y+=10;
    doc.setFontSize(14);
    doc.text("Totale Finale: ‚Ç¨ "+totaleGenerale.toFixed(2),220,y);

    doc.save("Report_Vendita_Film.pdf");
}

window.onload=caricaTabella;

</script>

</body>
</html>